openapi: 3.0.0
info:
  title: ClassDojo API docs
  version: 1.0.0
paths:
  "/getlinks":
    post:
      summary: get s3 bucket link
      description: Get a signed link generated by s3 bucket to allow for direct image upload
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/S3Links"

      responses:
        '200':
          description: Generated links for images
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/S3LinksResponse"
  "/analyze":
    post:
      summary: analyze video frames
      description: Get rekognition data analysis for images uploaded to s3 bucket related to a specific video
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/dataAnalysis"

      responses:
        '200':
          description: Analyzed data
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/dataAnalysisResponse"

  "/analyze/{videoId}":
    get:
      summary: get analysis from old video
      description: Get analysis record related to a specific video
      parameters:
        - in: path
          name: videoId
          schema:
            type: string
          required: true
          description: uuid of the video data to get

      responses:
        '200':
          description: Analysis record
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/analysisRecordResponse"

components:
  schemas:
    s3Response:
      properties:
        message:
          type: string
      required:
        - message

    S3LinksResponse:
      properties:
        links:
          type: array
      required:
        - links
      example:
        links: [
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/1.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=3e6994b8fb1ccd11614281d6dcd74c92223782ae2ffcdfe82aee6d611b40510e&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/2.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=0ec4f3b2e3fe83de13210d50ea58521d0531e433e4470d222a1ddcdd2dc8f5f1&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/3.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=2930a397e5b7f50b8828bc552b1262889c5a176dc4cb200ab48e7c03e86a024a&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/4.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=6d32d57f51551e57072fdb6c51cef9904f4bebe0a76579728150598da3a083d6&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/5.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=00c8100ffccab6012339e22e71c48261b6c1cb78dd90d42230e4cd27e21a07fe&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/6.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=f69f63526d876aa7c37bad458c985d32a26c6f9801a25548f581db753b871b68&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/7.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=8c58964d287b5cdead923f527d035f21a6e9ac3e20861ff051522f2ece3ab824&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/8.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=974292d746b3fa3e8061c44a85a806f6c88e5c6d8f97359993027c4dfbbf35d9&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/9.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=fbbd5850d6d88d41389988a6b2daeb96f0a57092229e8933c8f154f7f35d3543&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/10.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=dddd0d06b5d52aae148741971bd9273263fb29d46e7f2743bfdf57098b75dc19&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/11.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=b76ad42fdb9a291775c2a8bf8da795f7adac12f3af6cd35145e4d1802c2f17b6&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/12.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=48dc9c5a62f8b07506f4a56dcfeabf0123dd4e59a258821545931d24c9e942df&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/13.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=9033ef7e318deec468fc02d879712ac7747089c3edc5c330695b93490839a035&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/14.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=781dd278cb3f191cb2088cda337919deaec63d5a40f0393a46a555939bc8e8e3&X-Amz-SignedHeaders=host",
                "http://localhost:9000/images/44f33445-d099-46ec-9351-7dab5792beed/15.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220518%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220518T092135Z&X-Amz-Expires=604800&X-Amz-Signature=302adcfad1987a402ce83e42671c934eff591deab68a2cda6cd29ebbea1a06fb&X-Amz-SignedHeaders=host"
              ]


    S3Links:
      properties:
        videoId:
          type: string
        frames:
          type: array
      required:
        - videoId
        - frames
      #example:
      #  videoId: uuid
      #  frames: [uuid/1.jpg]

    dataAnalysis:
      properties:
        videoId:
          type: string
      required:
        - videoId
      #example:
      #  videoId: uuid

    dataAnalysisResponse:
      properties:
        framesArray:
          type: array
          items:
            type: object
            properties:
              attentionScore:
                type: number
              moodScore:
                type: number
              amountOfPeople:
                type: number
              isImportantAttention:
                type: boolean
              isImportantMood:
                type: boolean
              isImportantPeople:
                type: boolean
          example:
            - attentionScore: 0.65
              moodScore: 0.39
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.6
              moodScore: 0.4
              amountOfPeople: 19
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.89
              moodScore: 0.22
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.46
              moodScore: 0.36
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.54
              moodScore: 0.38
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.51
              moodScore: 0.35
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.48
              moodScore: 0.33
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.56
              moodScore: 0.4
              amountOfPeople: 17
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.78
              moodScore: 0.87
              amountOfPeople: 18
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.46
              moodScore: 0.29
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.53
              moodScore: 0.33
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.29
              moodScore: 0.18
              amountOfPeople: 16
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.31
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.46
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.10
              moodScore: 0.30
              amountOfPeople: 15
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
        peaks:
          type: object
          properties:
            moodPeak:
              type: number
            attentionPeak:
              type: number
            peoplePeak:
              type: number
          example:
            moodPeak: 0.46
            attentionPeak: 0.89
            peoplePeak: 19
        valleys:
          type: object
          properties:
            moodValley:
              type: number
            attentionValley:
              type: number
            peopleValley:
              type: number
          example:
            moodValley: 0.18
            attentionValley: 0.10
            peopleValley: 15
        averages:
          type: object
          properties:
            moodAverage:
              type: number
            attentionAverage:
              type: number
            peopleAverage:
              type: number
          example:
            moodAverage: 0.37
            attentionAverage: 0.55
            peopleAverage: 17
      required:
        - framesArray
        - peaks
        - valleys
        - averages

    analysisRecordResponse:
      properties:
        framesArray:
          type: array
          items:
            type: object
            properties:
              attentionScore:
                type: number
              moodScore:
                type: number
              amountOfPeople:
                type: number
              isImportantAttention:
                type: boolean
              isImportantMood:
                type: boolean
              isImportantPeople:
                type: boolean
          example:
            - attentionScore: 0.65
              moodScore: 0.39
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.6
              moodScore: 0.4
              amountOfPeople: 19
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.89
              moodScore: 0.22
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.46
              moodScore: 0.36
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.54
              moodScore: 0.38
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.51
              moodScore: 0.35
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.48
              moodScore: 0.33
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.56
              moodScore: 0.4
              amountOfPeople: 17
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.78
              moodScore: 0.87
              amountOfPeople: 18
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.46
              moodScore: 0.29
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.53
              moodScore: 0.33
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.29
              moodScore: 0.18
              amountOfPeople: 16
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.31
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.46
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.10
              moodScore: 0.30
              amountOfPeople: 15
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
        peaks:
          type: object
          properties:
            moodPeak:
              type: number
            attentionPeak:
              type: number
            peoplePeak:
              type: number
          example:
            moodPeak: 0.46
            attentionPeak: 0.89
            peoplePeak: 19
        valleys:
          type: object
          properties:
            moodValley:
              type: number
            attentionValley:
              type: number
            peopleValley:
              type: number
          example:
            moodValley: 0.18
            attentionValley: 0.10
            peopleValley: 15
        averages:
          type: object
          properties:
            moodAverage:
              type: number
            attentionAverage:
              type: number
            peopleAverage:
              type: number
          example:
            moodAverage: 0.37
            attentionAverage: 0.55
            peopleAverage: 17
        videoName:
          type: string
          example: "sample chunk"
        videoDate:
          type: string
          example: "2022-05-07T13:35:38.467Z"
        duration:
          type: number
          example: 76
        accuracy:
          type: number
          example: 5
      required:
        - framesArray
        - peaks
        - valleys
        - averages
        - videoName
        - videoDate
        - duration
        - accuracy