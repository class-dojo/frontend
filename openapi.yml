openapi: 3.0.0
info:
  title: ClassDojo API docs
  version: 1.0.0
paths:
  "/getlinks":
    post:
      summary: get s3 bucket link
      description: Get a signed link generated by s3 bucket to allow for direct image upload
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/S3Links"

      responses:
        '200':
          description: Generated links for images
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/S3LinksResponse"
  "/analyze":
    post:
      summary: analyze video frames
      description: Get rekognition data analysis for images uploaded to s3 bucket related to a specific video
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/dataAnalysis"

      responses:
        '200':
          description: Analyzed data
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/dataAnalysisResponse"

  "/analyze/{videoId}":
    get:
      summary: get analysis from old video
      description: Get analysis record related to a specific video
      parameters:
        - in: path
          name: videoId
          schema:
            type: string
          required: true
          description: uuid of the video data to get

      responses:
        '200':
          description: Analysis record
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/analysisRecordResponse"

components:
  schemas:
    s3Response:
      properties:
        message:
          type: string
      required:
        - message

    S3LinksResponse:
      properties:
        links:
          type: array
      required:
        - links
      example:
        links: [
                'http://localhost:9000/images/testVideo/image1.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=7fe772705878ac4178a56856f3052c35f17bb27f7c5ae4ba01a0e4f81785368e&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image2.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=313f68d1a0eb33b9d2265f771944b30468ff0a2e2d0fd36ba64119f988f05a07&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image3.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=baf1d5393d6314aa7e81049adc760e57c345ba47d2be1804d1110dce32622ad6&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image4.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=64dca4fdd41fbf085ffd1dcdd4dc2eeb63959456b3b51707aa41fb2282ba23bb&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image5.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=d89698ca4e996d1a4215bc042cfc09da4841d11df75559474e9998e6c10ca4bd&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image6.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=f958c0f6116267e3f3082153f67a8c906ecc50f76d8a445c855f4b49228b0ea8&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image7.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=9c7c74ea0cbb707b7bdacdb6a1f2005b2f25ffee4d1eecfd64ab0ca8a1ea8705&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image8.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=b62d6f0c66882ce4084e50cc0c322076c294d17dea81ecbd5f9fa7c0ec8b56f8&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image9.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=234d52909b3c64aca04a1b251245429779c63c21ee35034ec5e88610500a5b2f&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image10.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=122c2d4373ae5dbc2a1548fdc30668424b9e4c8a5e72c2b3e889f8f84a8281f1&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image11.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=003fb0dc18a7a6927dcd3e4e521629e9a54fff76928d90d3a77d7e3b1c03a1ea&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image12.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=0305f34d01faa544351be2e40d2f70bb059f4d10a9e7e71f1d30d457d7bb9fdf&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image13.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=bd17fa45b32b52d62411c4c0d0b513d10395d91007ede1c3dabedaf3e2801d74&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image14.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=7b104a61cfa80311ac95eeb331b9e63a32fce2743fcaad2bfb5cef7cafc67f49&X-Amz-SignedHeaders=host',
                'http://localhost:9000/images/testVideo/image15.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=root%2F20220516%2Feu-west-1%2Fs3%2Faws4_request&X-Amz-Date=20220516T183211Z&X-Amz-Expires=100000&X-Amz-Signature=8a5845604c82df957bc6c98110b17f4604282ed6a5629120715e1e8f51b2bc2b&X-Amz-SignedHeaders=host'
              ]


    S3Links:
      properties:
        videoId:
          type: string
        frames:
          type: array
      required:
        - videoId
        - frames
      #example:
      #  videoId: uuid
      #  frames: [uuid/1.jpg]

    dataAnalysis:
      properties:
        videoId:
          type: string
      required:
        - videoId
      #example:
      #  videoId: uuid

    dataAnalysisResponse:
      properties:
        framesArray:
          type: array
          items:
            type: object
            properties:
              attentionScore:
                type: number
              moodScore:
                type: number
              amountOfPeople:
                type: number
              isImportantAttention:
                type: boolean
              isImportantMood:
                type: boolean
              isImportantPeople:
                type: boolean
          example:
            - attentionScore: 0.65
              moodScore: 0.39
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.6
              moodScore: 0.4
              amountOfPeople: 19
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.89
              moodScore: 0.22
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.46
              moodScore: 0.36
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.54
              moodScore: 0.38
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.51
              moodScore: 0.35
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.48
              moodScore: 0.33
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.56
              moodScore: 0.4
              amountOfPeople: 17
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.78
              moodScore: 0.87
              amountOfPeople: 18
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.46
              moodScore: 0.29
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.53
              moodScore: 0.33
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.29
              moodScore: 0.18
              amountOfPeople: 16
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.31
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.46
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.10
              moodScore: 0.30
              amountOfPeople: 15
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
        peaks:
          type: object
          properties:
            moodPeak:
              type: number
            attentionPeak:
              type: number
            peoplePeak:
              type: number
          example:
            moodPeak: 0.46
            attentionPeak: 0.89
            peoplePeak: 19
        valleys:
          type: object
          properties:
            moodValley:
              type: number
            attentionValley:
              type: number
            peopleValley:
              type: number
          example:
            moodValley: 0.18
            attentionValley: 0.10
            peopleValley: 15
        averages:
          type: object
          properties:
            moodAverage:
              type: number
            attentionAverage:
              type: number
            peopleAverage:
              type: number
          example:
            moodAverage: 0.37
            attentionAverage: 0.55
            peopleAverage: 17
      required:
        - framesArray
        - peaks
        - valleys
        - averages

    analysisRecordResponse:
      properties:
        framesArray:
          type: array
          items:
            type: object
            properties:
              attentionScore:
                type: number
              moodScore:
                type: number
              amountOfPeople:
                type: number
              isImportantAttention:
                type: boolean
              isImportantMood:
                type: boolean
              isImportantPeople:
                type: boolean
          example:
            - attentionScore: 0.65
              moodScore: 0.39
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.6
              moodScore: 0.4
              amountOfPeople: 19
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.89
              moodScore: 0.22
              amountOfPeople: 19
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.46
              moodScore: 0.36
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.54
              moodScore: 0.38
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.51
              moodScore: 0.35
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.48
              moodScore: 0.33
              amountOfPeople: 18
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.56
              moodScore: 0.4
              amountOfPeople: 17
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.78
              moodScore: 0.87
              amountOfPeople: 18
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
            - attentionScore: 0.46
              moodScore: 0.29
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: true
            - attentionScore: 0.53
              moodScore: 0.33
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.29
              moodScore: 0.18
              amountOfPeople: 16
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.31
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: false
              isImportantPeople: false
            - attentionScore: 0.55
              moodScore: 0.46
              amountOfPeople: 16
              isImportantAttention: false
              isImportantMood: true
              isImportantPeople: false
            - attentionScore: 0.10
              moodScore: 0.30
              amountOfPeople: 15
              isImportantAttention: true
              isImportantMood: true
              isImportantPeople: true
        peaks:
          type: object
          properties:
            moodPeak:
              type: number
            attentionPeak:
              type: number
            peoplePeak:
              type: number
          example:
            moodPeak: 0.46
            attentionPeak: 0.89
            peoplePeak: 19
        valleys:
          type: object
          properties:
            moodValley:
              type: number
            attentionValley:
              type: number
            peopleValley:
              type: number
          example:
            moodValley: 0.18
            attentionValley: 0.10
            peopleValley: 15
        averages:
          type: object
          properties:
            moodAverage:
              type: number
            attentionAverage:
              type: number
            peopleAverage:
              type: number
          example:
            moodAverage: 0.37
            attentionAverage: 0.55
            peopleAverage: 17
        videoName:
          type: string
          example: "sample chunk"
        videoDate:
          type: string
          example: "2022-05-07T13:35:38.467Z"
        duration:
          type: number
          example: 76
        accuracy:
          type: number
          example: 5
      required:
        - framesArray
        - peaks
        - valleys
        - averages
        - videoName
        - videoDate
        - duration
        - accuracy